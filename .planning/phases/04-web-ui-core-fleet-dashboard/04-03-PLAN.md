---
phase: 04-web-ui-core-fleet-dashboard
plan: 03
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - apps/web/src/routes/index.tsx
  - apps/web/src/components/dashboard/bot-card.tsx
  - apps/web/src/components/dashboard/bot-grid.tsx
  - apps/web/src/components/dashboard/stats-bar.tsx
  - apps/web/src/components/dashboard/empty-state.tsx
  - apps/web/src/components/dashboard/create-bot-dialog.tsx
  - apps/web/src/hooks/use-bot-queries.ts
  - apps/web/src/hooks/use-stats-query.ts
autonomous: true

must_haves:
  truths:
    - "User opens / and sees a stats bar at the top with total bots, active sessions, and total conversations"
    - "Stats are clickable to filter the bot grid (clicking 'Active' filters to active bots only)"
    - "Bot cards show emoji avatar, name, status badge (color-coded green/yellow/red), model, last activity, session count, and soul snippet"
    - "Each card has a Chat button and overflow menu with edit, disable, delete actions"
    - "Search box filters bots by name and sort dropdown orders by name, last activity, or status"
    - "Empty state shows illustration and 'Create your first bot' CTA button"
    - "Create Bot button opens a dialog to create a new bot"
    - "On mobile, Create Bot is a FAB; on desktop, it is in the header"
  artifacts:
    - path: "apps/web/src/components/dashboard/bot-card.tsx"
      provides: "Individual bot card component"
      contains: "STATUS_COLORS"
    - path: "apps/web/src/components/dashboard/stats-bar.tsx"
      provides: "Clickable stats bar"
      contains: "total_bots"
    - path: "apps/web/src/hooks/use-bot-queries.ts"
      provides: "TanStack Query hooks for bot CRUD"
      exports: ["useBots", "useBot", "useCreateBot", "useUpdateBot", "useDeleteBot"]
  key_links:
    - from: "apps/web/src/components/dashboard/bot-grid.tsx"
      to: "/api/v1/bots"
      via: "useBots hook"
      pattern: "useBots"
    - from: "apps/web/src/components/dashboard/stats-bar.tsx"
      to: "/api/v1/stats"
      via: "useStats hook"
      pattern: "useStats"
    - from: "apps/web/src/components/dashboard/bot-card.tsx"
      to: "/bots/$botId"
      via: "TanStack Router Link"
      pattern: "Link.*bots"
---

<objective>
Build the fleet dashboard with stats bar, bot card grid, search/sort, empty state, and create bot dialog.

Purpose: The fleet dashboard is the landing page — users see all their bots at a glance with key metrics. This is the primary entry point for the web UI and covers requirements WEBU-01 (fleet overview).
Output: A fully functional dashboard at `/` with live data from the backend.
</objective>

<execution_context>
@/Users/smxaz7/.claude/get-shit-done/workflows/execute-plan.md
@/Users/smxaz7/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-web-ui-core-fleet-dashboard/04-RESEARCH.md
@.planning/phases/04-web-ui-core-fleet-dashboard/04-CONTEXT.md
@.planning/phases/04-web-ui-core-fleet-dashboard/04-02-SUMMARY.md

@apps/web/src/lib/api-client.ts
@apps/web/src/types/bot.ts
@apps/web/src/types/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Stats bar + bot card grid with search and sort</name>
  <files>
    apps/web/src/routes/index.tsx
    apps/web/src/components/dashboard/stats-bar.tsx
    apps/web/src/components/dashboard/bot-card.tsx
    apps/web/src/components/dashboard/bot-grid.tsx
    apps/web/src/hooks/use-bot-queries.ts
    apps/web/src/hooks/use-stats-query.ts
  </files>
  <action>
**use-stats-query.ts — Stats query hook:**
- `useStats()` hook using TanStack Query: `queryKey: ['stats']`, `queryFn` calls `apiFetch<Stats>('/stats')`, `staleTime: 30_000` (30s, stats are aggregate)
- Stats type: `{ total_bots: number, active_bots: number, disabled_bots: number, archived_bots: number, total_sessions: number, active_sessions: number, total_messages: number }`

**use-bot-queries.ts — Bot query hooks:**
- `useBots(filter?)` — `queryKey: ['bots', filter]`, calls `apiFetch<Bot[]>('/bots' + queryString)`, `staleTime: 10_000`
  - Filter object: `{ status?: string, sort?: string, search?: string, limit?: number, offset?: number }`
  - Build query string from filter params
- `useBot(idOrSlug)` — `queryKey: ['bot', idOrSlug]`, calls `apiFetch<Bot>('/bots/' + idOrSlug)`
- `useCreateBot()` — mutation calling `POST /bots` with body `{ name, description?, slug? }`, invalidates `['bots']` and `['stats']` on success, shows `toast.success('Bot created')`
- `useUpdateBot()` — mutation calling `PUT /bots/{id}`, invalidates `['bots', 'bot']`
- `useDeleteBot()` — mutation calling `DELETE /bots/{id}`, invalidates `['bots']` and `['stats']`, shows `toast.success('Bot deleted')`

**stats-bar.tsx — Clickable stats bar (per user decision):**
- Horizontal bar at the top of the dashboard
- Three stat items: "X Bots" (total), "X Active Sessions", "X Conversations" (total_messages)
- Each stat rendered as a clickable button/badge
- Clicking a stat sets a filter state (e.g., clicking "3 Active" filters the grid to active bots only)
- Use shadcn Card or a custom flex container with hover effects
- Show loading Skeletons while stats are loading
- Accept `onFilterChange(filter)` callback to communicate filter to the grid
- Visual: bold number, small label below, subtle border, hover highlight

**bot-card.tsx — Individual bot card (per user decision):**
- Use shadcn `Card` component
- Content: emoji avatar (user-assignable or auto-generated from first char of name), bot name (truncated), color-coded status badge (green for active, yellow for disabled, red for archived using shadcn Badge), model name, last activity time (relative via `formatDistanceToNow` from date-fns), session count, first line of soul snippet (personality preview, truncated)
- Quick actions: prominent "Chat" button (navigates to `/bots/${bot.id}/chat`) + overflow menu via shadcn `DropdownMenu` with Edit (navigates to bot detail), Disable/Enable toggle, Delete (with confirmation dialog)
- Delete confirmation: use shadcn `AlertDialog` — "Delete {bot.name}?" with cancel/confirm buttons
- Hover: subtle border color change, overflow menu icon becomes visible
- Responsive: card fills grid column

**bot-grid.tsx — Bot card grid with search and sort:**
- Local state for: `searchQuery`, `sortBy` (name | last_activity | status), `statusFilter` (from stats bar clicks)
- Search input: shadcn Input with search icon, filters by name (client-side for immediate responsiveness, since bot counts are small for single-user)
- Sort dropdown: shadcn Select with options: Name (A-Z), Last Activity, Status
- Grid layout: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4`
- Client-side pagination: 12 bots per page, show pagination controls if more (use simple prev/next or shadcn Pagination). Use TanStack Query's `keepPreviousData` for smooth page transitions.
- Filter bots by searchQuery (case-insensitive name match) and statusFilter
- Sort bots by selected sortBy field
- Show loading skeletons (6 skeleton cards matching card layout) while loading
- Show error state with retry button on failure

**routes/index.tsx — Dashboard page composition:**
- Page header: "Fleet Dashboard" title + "Create Bot" button (desktop only, hidden on mobile)
- Stats bar component
- Bot grid component
- Wire filter state: stats bar filter -> bot grid statusFilter
- Breadcrumb: just "Dashboard"
  </action>
  <verify>
Run `pnpm dev` and visit http://localhost:5173. With the Rust backend running:
1. Stats bar shows correct counts from /api/v1/stats
2. Bot cards render with all specified fields
3. Search filters bots by name
4. Sort dropdown reorders cards
5. Clicking a stat filters the grid
6. Chat button on card navigates to bot chat
7. Delete action works with confirmation
  </verify>
  <done>
Stats bar shows aggregate metrics with clickable filters. Bot cards display all required fields (emoji, name, status badge, model, activity, sessions, snippet). Search and sort work. Grid is responsive (1-4 columns).
  </done>
</task>

<task type="auto">
  <name>Task 2: Empty state + create bot dialog + mobile FAB</name>
  <files>
    apps/web/src/components/dashboard/empty-state.tsx
    apps/web/src/components/dashboard/create-bot-dialog.tsx
    apps/web/src/routes/index.tsx
  </files>
  <action>
**empty-state.tsx — CTA-focused empty state (per user decision):**
- Shown when bot list is empty (0 bots)
- Centered layout with: a simple SVG illustration (robot/bot icon, can be composed from Lucide icons like Bot + Sparkles), heading "Create your first bot", subtext "Get started by creating a bot with a unique personality", prominent "Create Bot" button using shadcn Button variant="default" size="lg"
- Button opens the create bot dialog
- Clean, minimal aesthetic matching the Linear-inspired dark theme

**create-bot-dialog.tsx — Create bot dialog:**
- Use shadcn `Dialog` component
- Form fields:
  - Name (required, text input, 3-50 chars)
  - Description (optional, textarea)
  - Emoji (optional, single emoji picker — simple text input for emoji, or a small grid of common emojis)
- Submit button: "Create Bot" — calls `useCreateBot()` mutation
- On success: close dialog, toast "Bot created", navigate to the new bot's detail page
- On error: show error message inline
- Loading state: button shows spinner/disabled while creating
- Controlled by `open` state, accept `onOpenChange` callback

**routes/index.tsx updates:**
- If bots list is empty, render `<EmptyState />` instead of the grid
- If bots exist, show the grid + stats bar
- Add mobile FAB (floating action button) for "Create Bot": fixed position bottom-right, visible only on mobile (`md:hidden`), circular button with Plus icon, opens create bot dialog. Per user decision: "Create Bot accessible via FAB on mobile + header button on desktop"
- Desktop: "Create Bot" button in page header area (already added in Task 1, ensure it opens dialog)
- Both FAB and header button share the same dialog state
  </action>
  <verify>
1. With zero bots: empty state renders with illustration and CTA
2. Click "Create Bot" — dialog opens with form
3. Fill form and submit — bot created, dialog closes, toast shows, navigates to bot
4. On mobile viewport: FAB visible at bottom-right, header button hidden
5. On desktop viewport: header button visible, FAB hidden
  </verify>
  <done>
Empty state shows when no bots exist with prominent CTA. Create bot dialog validates inputs and creates bots. FAB on mobile, header button on desktop — both open the same dialog.
  </done>
</task>

</tasks>

<verification>
1. Dashboard loads bot list from backend API
2. Stats bar shows correct aggregate numbers
3. Bot cards have all 7 specified fields (emoji, name, status, model, activity, sessions, snippet)
4. Search, sort, and filter all work
5. Empty state renders correctly when no bots
6. Create bot works end-to-end
7. Responsive grid adapts to screen size
8. Delete bot works with confirmation
</verification>

<success_criteria>
- Fleet dashboard matches all user decisions for card layout, stats bar, search/sort, empty state
- All data comes from real backend API calls (not mocked)
- TanStack Query manages server state with SWR
- Card actions (chat, edit, disable, delete) work
- Mobile FAB and desktop header button both create bots
</success_criteria>

<output>
After completion, create `.planning/phases/04-web-ui-core-fleet-dashboard/04-03-SUMMARY.md`
</output>
