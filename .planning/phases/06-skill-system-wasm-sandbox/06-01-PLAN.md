---
phase: 06-skill-system-wasm-sandbox
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - crates/boternity-types/src/skill.rs
  - crates/boternity-types/src/lib.rs
  - crates/boternity-types/Cargo.toml
  - crates/boternity-infra/Cargo.toml
  - crates/boternity-core/Cargo.toml
  - crates/boternity-api/Cargo.toml
  - Cargo.toml
autonomous: true

must_haves:
  truths:
    - "Skill domain types compile and are importable from boternity-types::skill"
    - "All three trust tiers (Local, Verified, Untrusted) are representable"
    - "Both skill types (Prompt, Tool) are representable"
    - "Capability enum covers all fine-grained operations from user decisions"
    - "New workspace dependencies (wasmtime, serde_yaml_ng, semver, petgraph, ratatui, landlock) are added"
  artifacts:
    - path: "crates/boternity-types/src/skill.rs"
      provides: "Skill domain types"
      contains: "SkillManifest"
    - path: "Cargo.toml"
      provides: "Workspace dependency declarations"
      contains: "wasmtime"
  key_links:
    - from: "crates/boternity-types/src/lib.rs"
      to: "crates/boternity-types/src/skill.rs"
      via: "pub mod skill"
      pattern: "pub mod skill"
---

<objective>
Define all skill system domain types in boternity-types and add Phase 6 workspace dependencies.

Purpose: Every subsequent plan depends on these shared types and library availability. This is the foundation for the entire skill system -- manifest structures, trust tiers, capabilities, permission grants, audit entries, and skill configuration types.

Output: `crates/boternity-types/src/skill.rs` with all domain types, updated workspace Cargo.toml with new dependencies, and per-crate Cargo.toml updates.
</objective>

<execution_context>
@/Users/smxaz7/.claude/get-shit-done/workflows/execute-plan.md
@/Users/smxaz7/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-skill-system-wasm-sandbox/06-CONTEXT.md
@.planning/phases/06-skill-system-wasm-sandbox/06-RESEARCH.md
@crates/boternity-types/src/lib.rs
@crates/boternity-types/Cargo.toml
@Cargo.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Skill domain types in boternity-types</name>
  <files>crates/boternity-types/src/skill.rs, crates/boternity-types/src/lib.rs</files>
  <action>
Create `crates/boternity-types/src/skill.rs` with the following types. All types derive Debug, Clone, Serialize, Deserialize unless noted.

**Core enums:**
- `SkillType` enum: `Prompt`, `Tool` -- serde rename_all = "snake_case"
- `TrustTier` enum: `Local`, `Verified`, `Untrusted` -- serde rename_all = "snake_case". Implement `Display` and `Default` (default = `Untrusted`).
- `Capability` enum with variants: `ReadFile`, `WriteFile`, `HttpGet`, `HttpPost`, `ExecCommand`, `ReadEnv`, `RecallMemory`, `GetSecret` -- serde rename_all = "snake_case". Use PartialEq, Eq, Hash for HashSet usage.

**Manifest types (agentskills.io compatible):**
- `SkillManifest` struct: name (String), description (String), license (Option<String>), compatibility (Option<String>), metadata (Option<SkillMetadata>), allowed_tools (Option<String>). Field `allowed_tools` uses serde rename "allowed-tools".
- `SkillMetadata` struct: author (Option<String>), version (Option<String>), skill_type (Option<SkillType>, serde rename "skill-type"), capabilities (Option<Vec<Capability>>), dependencies (Option<Vec<String>>), conflicts_with (Option<Vec<String>>, serde rename "conflicts-with"), trust_tier (Option<TrustTier>, serde rename "trust-tier"), parents (Option<Vec<String>>), secrets (Option<Vec<String>>), categories (Option<Vec<String>>).

**Permission types:**
- `PermissionGrant` struct: skill_name (String), capability (Capability), granted (bool), granted_at (chrono::DateTime<chrono::Utc>).
- `SkillPermissions` struct: skill_name (String), trust_tier (TrustTier), grants (Vec<PermissionGrant>), escalated (bool -- user escalated trust tier).

**Configuration types:**
- `BotSkillConfig` struct: skill_name (String), enabled (bool, default true), trust_tier (Option<TrustTier>), version (Option<String>), overrides (HashMap<String, String>), capabilities (Option<Vec<Capability>>).
- `BotSkillsFile` struct: skills (HashMap<String, BotSkillConfig>) -- represents the per-bot skills.toml.

**Audit types:**
- `SkillAuditEntry` struct: invocation_id (Uuid), skill_name (String), skill_version (String), trust_tier (TrustTier), capabilities_used (Vec<Capability>), input_hash (String -- SHA-256), output_hash (String), fuel_consumed (Option<u64>), memory_peak_bytes (Option<usize>), duration_ms (u64), success (bool), error (Option<String>), timestamp (chrono::DateTime<chrono::Utc>), bot_id (Uuid).

**Installed skill types:**
- `InstalledSkill` struct: manifest (SkillManifest), body (String -- markdown body from SKILL.md), source (SkillSource), install_path (PathBuf), wasm_path (Option<PathBuf> -- only for tool-based).
- `SkillSource` enum: `Local`, `Registry { registry_name: String, repo: String, path: String }` -- serde tag = "type", rename_all = "snake_case".
- `SkillMeta` struct (for .boternity-meta.toml): source (SkillSource), installed_at (chrono::DateTime<chrono::Utc>), version (String), checksum (String), trust_tier (TrustTier).

**Resource limits:**
- `ResourceLimits` struct: max_memory_bytes (usize, default 64MB), max_fuel (u64, default 1_000_000), max_duration_ms (u64, default 30_000).

Add `pub mod skill;` to `crates/boternity-types/src/lib.rs`.

Use `semver::Version` for the version field in SkillMeta (add semver to boternity-types dependencies). Use `uuid::Uuid` and `chrono` which are already workspace deps. Use `std::path::PathBuf` and `std::collections::HashMap`.
  </action>
  <verify>Run `cargo check -p boternity-types` -- must compile with no errors.</verify>
  <done>All skill domain types compile and are importable from `boternity_types::skill`.</done>
</task>

<task type="auto">
  <name>Task 2: Add Phase 6 workspace dependencies</name>
  <files>Cargo.toml, crates/boternity-infra/Cargo.toml, crates/boternity-core/Cargo.toml, crates/boternity-api/Cargo.toml, crates/boternity-types/Cargo.toml</files>
  <action>
Add new dependencies to the workspace root `Cargo.toml` under `[workspace.dependencies]`:
- `wasmtime = { version = "40", features = ["component-model", "async", "cranelift"] }`
- `wasmtime-wasi = "40"`
- `serde_yaml_ng = "0.10"`
- `semver = { version = "1", features = ["serde"] }`
- `petgraph = "0.7"`
- `ratatui = { version = "0.30", features = ["crossterm"] }`
- `landlock = "0.4"` (note: Linux only, will be behind cfg gate in infra)

Add to `crates/boternity-types/Cargo.toml`:
- `semver.workspace = true` (for SkillMeta version field)
- `serde_yaml_ng.workspace = true` (for manifest parsing helpers if co-located, but primarily used in core)

Add to `crates/boternity-core/Cargo.toml`:
- `serde_yaml_ng.workspace = true`
- `semver.workspace = true`
- `petgraph.workspace = true`

Add to `crates/boternity-infra/Cargo.toml`:
- `wasmtime.workspace = true`
- `wasmtime-wasi.workspace = true`
- `serde_yaml_ng.workspace = true`
- `semver.workspace = true`

Add to `crates/boternity-api/Cargo.toml`:
- `ratatui.workspace = true`

Do NOT add landlock yet -- it will be added in Plan 08 (OS sandbox) with proper cfg gates.

After adding dependencies, run `cargo check --workspace` to ensure everything resolves.
  </action>
  <verify>Run `cargo check --workspace` -- must compile with no errors. Verify `wasmtime` appears in Cargo.lock.</verify>
  <done>All Phase 6 dependencies are available in workspace and compile cleanly.</done>
</task>

</tasks>

<verification>
- `cargo check --workspace` passes
- `boternity_types::skill::SkillManifest` is importable
- `boternity_types::skill::TrustTier` has Local, Verified, Untrusted variants
- `boternity_types::skill::Capability` has all 8 capability variants
- wasmtime, serde_yaml_ng, semver, petgraph, ratatui are in Cargo.lock
</verification>

<success_criteria>
All skill domain types compile and are available to downstream crates. All Phase 6 workspace dependencies resolve and compile. No existing tests break.
</success_criteria>

<output>
After completion, create `.planning/phases/06-skill-system-wasm-sandbox/06-01-SUMMARY.md`
</output>
