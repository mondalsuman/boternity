---
phase: 06-skill-system-wasm-sandbox
plan: 11
type: execute
wave: 5
depends_on: ["06-08", "06-09", "06-10"]
files_modified:
  - crates/boternity-api/src/cli/skill.rs
  - crates/boternity-api/src/cli/skill_browser.rs
  - crates/boternity-api/src/cli/mod.rs
autonomous: true

must_haves:
  truths:
    - "User can create a local skill via bnity skill create"
    - "User can install a skill from a registry via bnity skill install"
    - "User can list, inspect, remove, enable/disable skills via CLI"
    - "User can browse skills interactively via TUI browser"
    - "User can publish a skill via bnity skill publish"
    - "bnity skill inspect shows resolved capabilities after inheritance"
  artifacts:
    - path: "crates/boternity-api/src/cli/skill.rs"
      provides: "CLI skill management commands"
      contains: "SkillCommand"
    - path: "crates/boternity-api/src/cli/skill_browser.rs"
      provides: "Interactive TUI skill browser"
      contains: "SkillBrowser"
  key_links:
    - from: "crates/boternity-api/src/cli/skill.rs"
      to: "crates/boternity-infra/src/skill/skill_store.rs"
      via: "install_skill, remove_skill, list_skills"
      pattern: "skill_store"
    - from: "crates/boternity-api/src/cli/skill_browser.rs"
      to: "crates/boternity-infra/src/skill/registry_client.rs"
      via: "search and list for discovery"
      pattern: "registry_client"
---

<objective>
Implement CLI skill management commands and interactive TUI skill browser.

Purpose: This is the primary user interface for skill management. Users create, install, remove, list, inspect, and publish skills via CLI commands. The interactive TUI browser provides a rich discovery experience with categories, search, and previews. Per user decision: "Interactive TUI browser for CLI skill discovery (categories, search, previews)."

Output: `bnity skill` subcommand tree and ratatui-based TUI skill browser.
</objective>

<execution_context>
@/Users/smxaz7/.claude/get-shit-done/workflows/execute-plan.md
@/Users/smxaz7/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-skill-system-wasm-sandbox/06-CONTEXT.md
@.planning/phases/06-skill-system-wasm-sandbox/06-RESEARCH.md
@crates/boternity-types/src/skill.rs
@crates/boternity-api/src/cli/mod.rs
@crates/boternity-infra/src/skill/skill_store.rs
@crates/boternity-infra/src/skill/registry_client.rs
@crates/boternity-core/src/skill/permission.rs
@crates/boternity-core/src/skill/inheritance.rs
@crates/boternity-core/src/skill/resolver.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: CLI skill management commands</name>
  <files>crates/boternity-api/src/cli/skill.rs, crates/boternity-api/src/cli/mod.rs</files>
  <action>
Create `crates/boternity-api/src/cli/skill.rs` using clap derive macros (same pattern as other CLI modules):

**SkillCommand enum** with subcommands:

1. **`create`** -- Create a new local skill
   - Args: `name: String`, `--type <prompt|tool>` (default: prompt)
   - Creates skill directory in `~/.boternity/skills/{name}/`
   - For prompt: scaffold SKILL.md with template frontmatter + placeholder body
   - For tool: scaffold SKILL.md + scripts/ directory with run.sh template
   - Print path to created skill and suggest editing SKILL.md

2. **`install`** -- Install skill from registry
   - Args: `source: String` (owner/repo or skill name), `--skill <name>` (specific skill from repo), `--bot <slug>` (attach to bot)
   - Flow: discover skills from source -> if multiple, let user select -> check dependencies (resolver) -> check conflicts -> prompt for capability approval (install-time, per user decision) -> install to skill store -> optionally attach to bot
   - Show: trust tier badge, capabilities required, dependencies to be installed
   - Per user decision: "Install-time approval: user reviews and approves all required capabilities during installation, no runtime prompts"

3. **`remove`** -- Remove an installed skill
   - Args: `name: String`, `--bot <slug>` (detach from bot only vs full removal)
   - If `--bot`: remove from bot's skills.toml only
   - Without `--bot`: remove from global skill store

4. **`list`** -- List installed skills
   - Args: `--bot <slug>` (filter to bot's skills)
   - Show: name, type (prompt/tool), trust tier, version, source, enabled/disabled
   - Color-code trust tiers: green (local), yellow (verified), red (untrusted)

5. **`inspect`** -- Show resolved skill details
   - Args: `name: String`
   - Show: full manifest, resolved capabilities (after inheritance), parent chain, conflicts_with, dependencies
   - Per user decision: "bnity skill inspect <name> shows resolved capability set after all inheritance"
   - Use `inspect_resolved_capabilities()` from inheritance module

6. **`attach`** -- Attach a skill to a bot
   - Args: `name: String`, `--bot <slug>` (required)
   - Add to bot's skills.toml with default config (enabled=true)

7. **`detach`** -- Detach a skill from a bot
   - Args: `name: String`, `--bot <slug>` (required)
   - Remove from bot's skills.toml

8. **`enable`/`disable`** -- Toggle skill per-bot
   - Args: `name: String`, `--bot <slug>` (required)
   - Update enabled field in bot's skills.toml

9. **`publish`** -- Publish a local skill
   - Args: `name: String`
   - Validate: SKILL.md parses, required fields present, version is valid semver
   - For now: validate only, print "Ready to publish. Push to a GitHub repository to make it available."
   - Future: create/push to GitHub repo

10. **`browse`** -- Open interactive TUI browser
    - Launches the TUI browser (Task 2)

11. **`update`** -- Check for and apply updates
    - Args: `--all` or `name: String`
    - Per user decision: "patches auto-update, minor/major require manual approval"
    - Check version against registry, show changes, apply if patch

Register `SkillCommand` in the top-level CLI command enum. Add `pub mod skill;` to cli/mod.rs. Wire the `bnity skill` subcommand.

For install-time capability approval, use a simple interactive prompt:
```
Skill 'web-scraper' requires the following capabilities:
  - http-get: Make HTTP GET requests
  - read-file: Read files
Approve all capabilities? [y/N]:
```
  </action>
  <verify>`cargo check -p boternity-api` passes. Run `cargo test -p boternity-api -- cli::skill` if any non-interactive tests exist.</verify>
  <done>Full CLI skill management: create, install, remove, list, inspect, attach, detach, enable/disable, publish, browse, update.</done>
</task>

<task type="auto">
  <name>Task 2: Interactive TUI skill browser</name>
  <files>crates/boternity-api/src/cli/skill_browser.rs, crates/boternity-api/src/cli/mod.rs</files>
  <action>
Create `crates/boternity-api/src/cli/skill_browser.rs` using ratatui:

Per user decision: "Interactive TUI browser for CLI skill discovery (categories, search, previews)"

**SkillBrowser struct:**
```rust
pub struct SkillBrowser {
    skills: Vec<DiscoveredSkill>,
    filtered: Vec<usize>,       // indices into skills
    selected: usize,
    search_query: String,
    search_mode: bool,
    current_category: Option<String>,
    categories: Vec<String>,
    detail_mode: bool,          // showing full detail panel
}
```

**Layout (3-pane):**
- Left pane (20%): Category list (predefined categories from user decision)
  - All Skills, Business & Marketing, Communication & Writing, Creative & Media, Development, Productivity & Organization
- Center pane (50%): Skill list (name, description truncated, trust tier badge, install count)
  - Scrollable with j/k or arrow keys
  - Selected skill highlighted
- Right pane (30%): Detail panel for selected skill
  - Name, description (full), author, version, trust tier, capabilities, dependencies, install count

**Keybindings:**
- `/` -- Enter search mode (type to filter)
- `Enter` -- Install selected skill (exits TUI, runs install flow)
- `Esc` -- Exit search mode or exit browser
- `q` -- Quit browser
- `Tab` -- Cycle between panes
- `j`/`k` or Up/Down -- Navigate skill list
- `i` -- Toggle detail panel

**Rendering with ratatui:**
- Use `Layout::horizontal` for the 3-pane split
- Use `List` widget for categories and skills
- Use `Paragraph` widget for detail panel
- Use `Block` with borders for each pane
- Trust tier colors: green (local), yellow (verified), red (untrusted)
- Source badges prominently displayed per user decision

**Data loading:**
- On startup, load from cached indices (fast)
- Show "Loading..." if cache is stale, refresh in background
- Combine results from all enabled registries

**Entry point:**
```rust
pub async fn run_browser(registries: &[GitHubRegistryClient], cache_dir: &Path) -> anyhow::Result<Option<DiscoveredSkill>>
```
Returns the selected skill (for installation) or None if user quit.

Add `pub mod skill_browser;` to cli/mod.rs.

Use crossterm backend (already in workspace). Enable raw mode during TUI, restore on exit (including on panic with catch_unwind or terminal restore hook).
  </action>
  <verify>`cargo check -p boternity-api` passes. Visual verification of TUI is deferred to Plan 12 checkpoint.</verify>
  <done>Interactive TUI browser with categories, search, previews, and skill selection for installation.</done>
</task>

</tasks>

<verification>
- `cargo check -p boternity-api` passes
- `bnity skill --help` shows all subcommands
- `bnity skill list` returns empty list (no skills installed yet)
- `bnity skill create test-skill` creates skill directory with SKILL.md template
</verification>

<success_criteria>
Full CLI skill management is operational. Users can create, install, remove, list, inspect, attach, detach, enable/disable, publish, browse, and update skills. TUI browser renders with categories, search, and detail panels. Install-time capability approval prompts user before granting permissions.
</success_criteria>

<output>
After completion, create `.planning/phases/06-skill-system-wasm-sandbox/06-11-SUMMARY.md`
</output>
