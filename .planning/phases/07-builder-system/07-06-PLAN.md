---
phase: 07-builder-system
plan: 06
type: execute
wave: 4
depends_on: ["07-04", "07-05"]
files_modified:
  - crates/boternity-core/src/builder/skill_builder.rs
  - crates/boternity-core/src/builder/mod.rs
  - crates/boternity-core/src/builder/assembler.rs
autonomous: true

must_haves:
  truths:
    - "Builder can create skills from natural language descriptions"
    - "Created skills follow agentskills.io spec (SKILL.md manifest)"
    - "Skills are auto-attached during bot creation, removable at review step"
    - "Standalone skill creation available outside bot flow"
    - "Permissions auto-suggested based on skill description"
  artifacts:
    - path: "crates/boternity-core/src/builder/skill_builder.rs"
      provides: "SkillBuilder for creating skills from descriptions"
      contains: "SkillBuilder"
  key_links:
    - from: "crates/boternity-core/src/builder/skill_builder.rs"
      to: "crates/boternity-core/src/skill/manifest.rs"
      via: "generates SKILL.md manifest"
      pattern: "SkillManifest"
    - from: "crates/boternity-core/src/builder/assembler.rs"
      to: "crates/boternity-core/src/builder/skill_builder.rs"
      via: "assembler uses skill_builder for skill attachment"
      pattern: "SkillBuilder"
---

<objective>
Implement the skill builder that creates skills from natural language descriptions via LLM.

Purpose: Users describe what a skill should do, and the builder generates a SKILL.md manifest, suggests permissions, and optionally generates WASM source code. This powers both inline skill creation during bot building and standalone `bnity skill create` flows.
Output: SkillBuilder module in boternity-core, skill attachment wired into BotAssembler.
</objective>

<execution_context>
@/Users/smxaz7/.claude/get-shit-done/workflows/execute-plan.md
@/Users/smxaz7/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-builder-system/07-RESEARCH.md
@.planning/phases/07-builder-system/07-CONTEXT.md
@.planning/phases/07-builder-system/07-04-SUMMARY.md
@.planning/phases/07-builder-system/07-05-SUMMARY.md
@crates/boternity-core/src/skill/manifest.rs
@crates/boternity-types/src/skill.rs
@crates/boternity-types/src/builder.rs
@crates/boternity-infra/src/skill/skill_store.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: SkillBuilder for LLM-driven skill creation</name>
  <files>
    crates/boternity-core/src/builder/skill_builder.rs
    crates/boternity-core/src/builder/mod.rs
  </files>
  <action>
    Create `crates/boternity-core/src/builder/skill_builder.rs`:

    **SkillBuilder** struct (stateless utility, provider passed per-call):
    ```rust
    pub struct SkillBuilder;
    ```

    **SkillBuildRequest** struct: `name: String, description: String, skill_type: SkillBuildType, capabilities: Option<Vec<String>>`.

    **SkillBuildType** enum: `Local`, `Wasm { language: String }` (language defaults to "rust" per user decision).

    **SkillBuildResult** struct: `manifest: SkillManifest, skill_md_content: String, source_code: Option<String>, suggested_capabilities: Vec<SuggestedCapability>`.

    **SuggestedCapability** struct: `capability: String, reason: String`. Per user decision: auto-suggest capabilities based on description with reasons ("This skill needs network access because you mentioned fetching web data").

    **impl SkillBuilder:**

    **`pub async fn generate_skill(provider: &BoxLlmProvider, request: &SkillBuildRequest) -> Result<SkillBuildResult, BuilderError>`**

    1. Build a system prompt instructing the LLM to generate a SKILL.md manifest:
    ```xml
    <skill_builder_instructions>
    Generate a SKILL.md manifest following the agentskills.io specification.

    The manifest must include:
    - name (slug format: lowercase, hyphens, no spaces)
    - version: 0.1.0
    - description: clear, concise
    - capabilities: list of required permissions
    - trigger: when to activate this skill
    - instructions: detailed instructions for the agent using this skill

    Output as a JSON object with fields: skill_md (the full SKILL.md content), capabilities (array of {capability, reason}), source_code (Rust source if WASM type, null if local).
    </skill_builder_instructions>
    ```

    2. Use structured output with a SkillGenerationResponse schema (define locally, not exported):
    `skill_md: String, capabilities: Vec<{capability: String, reason: String}>, source_code: Option<String>`.

    3. Parse the LLM response and construct SkillBuildResult.

    4. For WASM skills: the LLM generates Rust source code. Per user decision, Rust is the default language. The source code should implement the WIT interface from Phase 6 (boternity:skill/execute).

    5. For Local skills: no source code needed, just the SKILL.md manifest (prompt-based skills).

    **`pub fn suggest_capabilities(description: &str) -> Vec<SuggestedCapability>`**

    Heuristic (non-LLM) capability suggestion for quick inline use:
    - "fetch", "http", "web", "api", "url" -> network_access ("Needs to make HTTP requests")
    - "file", "read", "write", "disk", "save" -> file_read or file_write
    - "environment", "env", "config" -> env_read
    - "time", "date", "schedule" -> no special capability (always available)
    - "database", "sql", "query" -> network_access ("Database connections require network")

    **`pub async fn validate_skill(provider: &BoxLlmProvider, skill_md: &str) -> Result<Vec<String>, BuilderError>`**

    Parse the generated SKILL.md using `parse_skill_md` from boternity-core::skill::manifest. Return a list of validation warnings (empty if valid). This is the "compile/run a basic test" per user decision -- for now, structural validation only.

    Update `crates/boternity-core/src/builder/mod.rs` to add `pub mod skill_builder;`.
  </action>
  <verify>
    `cargo check -p boternity-core` compiles.
    Add tests:
    - test suggest_capabilities returns network_access for "fetch data from API"
    - test suggest_capabilities returns file_read for "read config files"
    - test validate_skill with a valid SKILL.md returns no warnings
    - test validate_skill with invalid SKILL.md returns warnings
    Run `cargo test -p boternity-core builder::skill_builder` -- tests pass.
  </verify>
  <done>SkillBuilder generates SKILL.md manifests from descriptions via LLM. Capability suggestion works both heuristically and via LLM. Validation catches manifest errors.</done>
</task>

<task type="auto">
  <name>Task 2: Wire skill attachment into BotAssembler</name>
  <files>
    crates/boternity-core/src/builder/assembler.rs
  </files>
  <action>
    Update BotAssembler to handle skill creation and attachment:

    1. Add a method **`pub async fn attach_skills(bot_slug: &str, skills: &[SkillBuildResult], data_dir: &Path) -> Result<Vec<String>, BuilderError>`**:
    - For each SkillBuildResult:
      a. Write the SKILL.md content to `{data_dir}/skills/{skill_name}/SKILL.md`
      b. If source_code is Some, write to `{data_dir}/skills/{skill_name}/src/lib.rs`
      c. Add the skill to the bot's skills.toml (use `save_bot_skills_config` from manifest module)
    - Return list of attached skill names
    - Per user decision: auto-attach during bot creation, but skills are listed in the review step where user can remove them

    2. Update the `assemble()` method to:
    - After creating the bot and writing identity files
    - If config.skills is non-empty, call attach_skills for each
    - Populate AssemblyResult.skills_attached with attached skill names
    - Add `builder-created` metadata tag per user decision (origin tracking)

    3. Add **`pub fn format_assembly_summary(result: &AssemblyResult) -> String`** that produces the CLI post-create output per user decision: "detailed summary -- bot name, slug, file paths, attached skills, model, everything at a glance". Format as:
    ```
    Bot Created: {name}
    Slug: {slug}
    Category: {category}
    Model: {model} (temperature: {temp})

    Files:
      SOUL.md:     {soul_path}
      IDENTITY.md: {identity_path}
      USER.md:     {user_path}

    Skills ({count}):
      - {skill_name}: {description}

    Next: bnity chat {slug}
    ```
  </action>
  <verify>
    `cargo check -p boternity-core` compiles.
    Add tests:
    - test format_assembly_summary includes all fields
    - test attach_skills writes files to correct paths (use temp dir)
    Run `cargo test -p boternity-core builder::assembler` -- tests pass.
  </verify>
  <done>BotAssembler creates bots with skills attached. Skills get builder-created tag. Post-create summary formatted for CLI display.</done>
</task>

</tasks>

<verification>
- `cargo check --workspace` compiles
- `cargo test -p boternity-core builder` passes all tests
- SkillBuilder generates valid SKILL.md from descriptions
- BotAssembler attaches skills during bot creation
- Assembly summary shows all created artifacts
</verification>

<success_criteria>
- SkillBuilder::generate_skill produces SKILL.md from natural language
- suggest_capabilities returns relevant permissions with reasons
- validate_skill catches manifest errors
- BotAssembler::attach_skills writes skill files and updates skills.toml
- builder-created metadata tag applied to created skills
- format_assembly_summary produces detailed CLI output
</success_criteria>

<output>
After completion, create `.planning/phases/07-builder-system/07-06-SUMMARY.md`
</output>
