---
phase: 07-builder-system
plan: 09
type: execute
wave: 6
depends_on: ["07-08"]
files_modified:
  - apps/web/src/routes/builder/index.tsx
  - apps/web/src/routes/builder/wizard.tsx
  - apps/web/src/lib/api/builder.ts
  - apps/web/src/stores/builder-store.ts
  - apps/web/src/components/builder/wizard-step.tsx
  - apps/web/src/components/builder/builder-preview.tsx
  - apps/web/src/components/builder/builder-review.tsx
  - apps/web/src/routes/__root.tsx
autonomous: false

must_haves:
  truths:
    - "User can access the wizard from dashboard Create Bot button"
    - "Wizard has step-by-step pages: Basics, Personality, Model, Skills, Review"
    - "User can navigate back and forward between steps"
    - "Live preview updates after each step"
    - "Review step shows full summary with option to see raw files"
    - "Confirmation creates the bot and redirects to chat"
  artifacts:
    - path: "apps/web/src/routes/builder/wizard.tsx"
      provides: "Step-by-step wizard pages"
      contains: "WizardPage"
    - path: "apps/web/src/lib/api/builder.ts"
      provides: "Builder API client"
      contains: "createBuilderSession"
    - path: "apps/web/src/stores/builder-store.ts"
      provides: "Builder state management"
      contains: "useBuilderStore"
  key_links:
    - from: "apps/web/src/routes/builder/wizard.tsx"
      to: "apps/web/src/lib/api/builder.ts"
      via: "wizard calls API on each step"
      pattern: "submitAnswer"
    - from: "apps/web/src/lib/api/builder.ts"
      to: "/api/v1/builder/sessions"
      via: "REST API calls"
      pattern: "api/v1/builder"
---

<objective>
Build the web UI step-by-step wizard for bot creation.

Purpose: Per user decision, the web UI has both a chat-based builder bot (Forge) AND a step-by-step wizard overlay. This plan builds the wizard -- step-by-step pages (Basics, Personality, Model, Skills, Review) with back/next navigation. The wizard uses REST endpoints from Plan 08.
Output: Wizard route, step components, API client, state store.
</objective>

<execution_context>
@/Users/smxaz7/.claude/get-shit-done/workflows/execute-plan.md
@/Users/smxaz7/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-builder-system/07-RESEARCH.md
@.planning/phases/07-builder-system/07-CONTEXT.md
@.planning/phases/07-builder-system/07-08-SUMMARY.md
@apps/web/src/routes/__root.tsx
@apps/web/src/routes/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Builder API client and state store</name>
  <files>
    apps/web/src/lib/api/builder.ts
    apps/web/src/stores/builder-store.ts
  </files>
  <action>
    1. Create `apps/web/src/lib/api/builder.ts`:

    TypeScript types mirroring Rust types:
    ```typescript
    interface BuilderTurn {
      action: 'ask_question' | 'show_preview' | 'ready_to_assemble' | 'clarify';
      // Union fields based on action
      phase?: string;
      question?: string;
      options?: QuestionOption[];
      allow_free_text?: boolean;
      phase_label?: string;
      preview?: BuilderPreview;
      config?: BuilderConfig;
      message?: string;
    }

    interface QuestionOption {
      id: string;
      label: string;
      description?: string;
    }

    interface BuilderPreview {
      name?: string;
      description?: string;
      personality_summary?: string;
      model?: string;
      skills: string[];
      phase: string;
    }

    interface BuilderConfig {
      name: string;
      description: string;
      category: string;
      tags: string[];
      personality: PersonalityConfig;
      model_config: ModelConfig;
      skills: SkillRequest[];
    }

    // ... PersonalityConfig, ModelConfig, SkillRequest, AssemblyResult
    ```

    API functions:
    - `createBuilderSession(description: string): Promise<{ session_id: string; turn: BuilderTurn }>`
    - `submitAnswer(sessionId: string, answer: BuilderAnswer): Promise<{ turn: BuilderTurn }>`
    - `assembleBot(sessionId: string, config: BuilderConfig): Promise<{ result: AssemblyResult }>`
    - `getSession(sessionId: string): Promise<SessionState>`
    - `listDrafts(): Promise<DraftSummary[]>`
    - `deleteSession(sessionId: string): Promise<void>`

    All use fetch with JSON body, standard error handling.

    2. Create `apps/web/src/stores/builder-store.ts`:

    Zustand store:
    ```typescript
    interface BuilderState {
      sessionId: string | null;
      currentTurn: BuilderTurn | null;
      phase: string;
      history: BuilderTurn[];  // for back navigation
      preview: BuilderPreview | null;
      isLoading: boolean;
      error: string | null;

      // Actions
      startSession: (description: string) => Promise<void>;
      submitAnswer: (answer: BuilderAnswer) => Promise<void>;
      goBack: () => Promise<void>;
      assemble: (config: BuilderConfig) => Promise<AssemblyResult>;
      reset: () => void;
    }
    ```

    Store manages the conversation flow:
    - startSession: calls createBuilderSession, sets sessionId and first turn
    - submitAnswer: calls API, pushes current turn to history, sets new turn
    - goBack: calls submitAnswer with Back answer, pops from history
    - assemble: calls assembleBot, returns result
    - Tracks loading state for UI spinners
  </action>
  <verify>
    TypeScript compiles: `cd apps/web && npx tsc --noEmit`
    Types match the REST API response shapes from Plan 08.
  </verify>
  <done>Builder API client with typed functions. Zustand store managing wizard conversation state with history for back navigation.</done>
</task>

<task type="auto">
  <name>Task 2: Step-by-step wizard UI</name>
  <files>
    apps/web/src/routes/builder/index.tsx
    apps/web/src/routes/builder/wizard.tsx
    apps/web/src/components/builder/wizard-step.tsx
    apps/web/src/components/builder/builder-preview.tsx
    apps/web/src/components/builder/builder-review.tsx
  </files>
  <action>
    1. Create `apps/web/src/routes/builder/index.tsx`:
    Landing page with:
    - "Create a New Bot" heading
    - Text input for initial description: "Describe the bot you want to create..."
    - "Start Wizard" button -> navigates to wizard route with description
    - "Or chat with Forge" link -> navigates to Forge chat (Plan 10)
    - "Resume Draft" section if drafts exist (list from API)

    2. Create `apps/web/src/routes/builder/wizard.tsx`:
    The wizard page layout. Per user decision: step-by-step pages with back/next navigation.

    Structure:
    ```tsx
    // Step indicator bar at top
    <div className="flex gap-2 mb-8">
      {['Basics', 'Personality', 'Model', 'Skills', 'Review'].map((step, i) => (
        <div key={step} className={cn(
          "flex-1 h-1 rounded",
          i <= currentStepIndex ? "bg-primary" : "bg-muted"
        )} />
      ))}
    </div>

    // Current step content
    <WizardStep turn={currentTurn} onAnswer={handleAnswer} />

    // Navigation footer
    <div className="flex justify-between mt-8">
      <Button variant="ghost" onClick={handleBack} disabled={!canGoBack}>
        Back
      </Button>
      <Button onClick={handleNext} disabled={isLoading}>
        {isLastStep ? 'Review' : 'Next'}
      </Button>
    </div>
    ```

    The wizard doesn't control steps directly -- it renders whatever BuilderTurn the API returns. The step indicator updates based on the phase field in the turn.

    3. Create `apps/web/src/components/builder/wizard-step.tsx`:
    Renders a BuilderTurn as a wizard step:
    - AskQuestion: render question text, option cards (radio-button style), optional free-text input
    - Option cards show label + description, selected state with ring highlight
    - ShowPreview: render the preview component inline
    - Clarify: show message with text input

    Use shadcn/ui components: RadioGroup, Card, Input, Label, Badge.

    4. Create `apps/web/src/components/builder/builder-preview.tsx`:
    Growing preview panel (shown on the right or below on mobile):
    - Bot name, description
    - Personality summary (tone, traits)
    - Model info
    - Skills list with badges
    - Updates reactively as answers come in

    5. Create `apps/web/src/components/builder/builder-review.tsx`:
    Full review step per user decision:
    - Structured summary by default
    - "Show raw files" toggle to see actual SOUL.md, IDENTITY.md content
    - Skills listed with remove buttons (auto-attached but removable)
    - "Create Bot" primary action button
    - Success state: bot created, link to chat

    6. Register the builder route in TanStack Router. Add to the routes tree. Entry points per user decision:
    - Dashboard "Create Bot" button links to /builder
    - Bot detail page "Reconfigure" button links to /builder?reconfigure={slug}
  </action>
  <verify>
    `cd apps/web && npm run build` completes without errors.
    `cd apps/web && npx tsc --noEmit` type-checks.
  </verify>
  <done>Step-by-step wizard with progress indicator, option cards, live preview, review with raw file toggle, and back/next navigation.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Web UI builder wizard with step-by-step pages, live preview, and review confirmation</what-built>
  <how-to-verify>
    1. Start the dev server: `cargo run` (backend) and `cd apps/web && npm run dev` (frontend)
    2. Navigate to the dashboard
    3. Click "Create Bot" -- should go to /builder
    4. Enter a description like "I want a coding assistant that helps with Rust"
    5. Click "Start Wizard"
    6. Verify: step indicator shows progress
    7. Verify: each step shows multi-choice options with descriptions
    8. Verify: back button returns to previous step
    9. Verify: preview panel updates after each step
    10. At Review step: verify structured summary shows all chosen config
    11. Click "Create Bot" -- verify bot is created
    12. Verify: redirected to chat with the new bot
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- Web app builds without errors
- TypeScript type-checks
- Wizard accessible from dashboard "Create Bot" button
- Step-by-step flow works with back/next navigation
- Live preview updates
- Review shows full config with raw file toggle
- Bot creation works end-to-end
</verification>

<success_criteria>
- Wizard has step indicator and back/next navigation
- Options rendered as selectable cards with descriptions
- Live preview updates after each step
- Review step shows structured summary with raw file toggle
- "Create Bot" creates the bot and offers chat link
- Resume drafts section works
</success_criteria>

<output>
After completion, create `.planning/phases/07-builder-system/07-09-SUMMARY.md`
</output>
